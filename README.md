# TDC (top-down-craft)

Я очень люблю Valheim. То есть выживалки. С этого все и началось. Зачем вечно делать платформеры и учиться на них, когда...

Когда можно поставить себе челендж сделать за 2 дня скелет выживалки, где ты можешь ~~грабить корованы~~, добывать ресуры и крафтить новые предметы не зная практически ничего о Godot!!! (то есть можно что-то ломать, оттуда что-то падает, подбирается и отображается в инвентаре, где можно скрафтить по рецепту новый предмет и поставить его на уровне)

Короче...

## Что уже сделано

### Разное

- Уровень в 1920х1080, перезапускается на R и закрывается на Esc

### Игрок

- Есть игрок (`Player`, `CharacterBody2D`)
- Игрок нарисован
- Игрок передвигается на WASD
- Игрок смотрит на мышь (крутится его обьект)
- При клике проигрывается анимация удара меча (крутится реальный обьект, анимация не фиктивная)
- Меч это отдельная нода в дереве игрока
- Направление удара меча всегда следует за мышкой (атакует туда, куда смотрит игрок)
- Когда игрок поворачивается во время атаки, то меч перестает следовать его взгляду (иначе это выглядело очень странно)
- Когда меч с чемто соприкасается, то вызывается сигнал атаки

### Обьекты

- Есть кусты (`ItemObject`, `StaticBody2D`)
- Куст нарисован
- Куст имеет хп
- Куст при попадании мечом получает урон и мигает (`sprite.modulate`)
- На кусте в Loot Settings можно указать какой предмет будет выпадать (`PackedScene`), количество и шанс выпадения
- С куста падает дерево в количестве 1-3 с 75% шансом

### Предметы

- Дерево нарисовано и создан ресурс (`Resource`, `.tres`)
- Дерево (`ItemDrop`, `Area2D`) не имеет коллизии ~~и может быть подобрано игроком~~ (пока нет)
- Когда дерево спавнится, то определяется случайная позиция в радиусе от куста, куда движется предмет дерева (tween анимация) - кучка нескольких дропов распределена в радиусе, а не лежит друг на друге
- ~~Есть ягода, семя, но они пока ниоткуда не выпадают и не отображаются в игре (`ItemDrop`, `Area2D`)~~
- Ягода нарисована и создан ресурс
- Семя нарисовано и создан ресурс

### Система лута

- Таблица лута (`LootTable`) с конфигом предметов для дропа (`ItemResource`)
- Кусту присваивается таблица, в которой настроено сразу какие вещи будут падать
- Теперь не нужно делать отдельные сцены для каждого нового предмета, тк они автоматически генерируются на базе конфига предмета лута (`ItemResource`) и сцены (`ItemDrop`)
- У игрока есть радиус сбора предметов
- ~~Когда предмет находится в этом радиусе, то пульсирует (hightlight), иначе лежит неподвижно~~ (изменено)
- При нажатии кнопки E, все предметы в радиусе сбора подбираются (анимация притягивания к игроку, добавление в инвентарь)
- Можно включить автолут на Q и тогда предметы будут собираться автотически, когда в радиусе сбора
- Когда предмет в радиусе сбора, то обводится белым контуром с плавной анимацией (первый раз писал шейдер, вухуу)

> На данном этапе прошло уже 3 дня. Основные сложности заключались в непонимании апихи годота, реализации анимаций и сложнее всего было соединить все сигналы между разными обьектами так, чтобы в момент рендера и появление обьектов, они могли все считаться, было непонятно, когда что отрисовывается, оказалось, что если обьект спавнится внутри Area2D, на которой висит area_entered, то обьект не будет прочитан, а так же различные собственные ошибки в алгоритмах
>
> Короче это сложнее, чем казалось
>
> НО! Будь я опытным разработчиком, то 100% сделал бы все за 2 дня.

## Инвентарь

- На Tab можно открыть инвентарь
- Когда предметы подбираются, то сразу отображаются в инвентаре
- Каждый предмет находится в слоте, а в углу отображается количество
- (на самом деле это было пиздец как сложно сделать, я столько раз путался, ПОЧЕМУ В GODOT ТАКАЯ ПЛОХАЯ СИСТЕМА ТИПОВ? Я только изза этого ошибки допускал, когда нет проверки, что я передал `Dictionary`, а не `ItemResource`)
- Нарисовал текстуры для инвентаря (слоты, панель, углы, обводка)
- Анимация, когда добавляется предмет в инвентарь

## Анимации

- Объект на уровне мигает, когда получает урон (`modulate`)
- Поворот меча при ударе (`rotation`)
- При выпадении лут разлетается в радиусе бывшего объекта (`position`, `modulate:a`)
- Лут обводится белым контуром, когда находится в радиусе подбора игрока (`shader_material/outline_width`, `shader_material/outline_color`)
- Лут летит в игрока, когда игрок его подбирает (`position`, `modulate:a`)
- Предмет в инвентаре пульсирует, когда добавляется (`scale`)

# План действий

1. ~~**Движение:** Камера, игрок (CharacterBody2D), управление WASD (velocity).~~
2. ~~**Мышь:** Поворот игрока/оружия в сторону курсора (`look_at()`).~~
3. ~~**Атака (Конус):** Реализуй `Area2D` для меча, логику включения по нажатию кнопки, расчет попадания (dot product или простой луч).~~
4. ~~**Объекты:** Создай серый/зеленый объекты (StaticBody2D). Сделай их разрушение при попадании атаки, спавн "дропа" (нод с Sprite2D/ColorRect + Area2D для подбора).~~
   4.5. ~~**Дроп**: Когда Item удаляется, то на его месте должен появиться уменьшенный его вариант, который потом можно будет подбирать~~ \
   ~~Падает несколько обьектов в зависимости от min,max в разных позицих. Так же item плучаетс урон и имеет хп~~ \
   ~~Даже добавил анимацию разлета, когда ломаешь куст~~ \
   ~~Сделал таблицу лута с вариантивной настройкой лута для обектов~~ \

5. ~~**Подбор:** Добавь зону подбора у игрока, логику сбора дропа по кнопке (E) и добавления в *простую* структуру инвентаря (пока что просто `var inventory: Dictionary = {}`).~~
6. ~~**Инвентарь (UI):** Создай сцену UI с GridContainer (сетка слотов). Научись открывать/закрывать ее по Tab. Отображай пустые слоты. А когда предметы собираются, то отображай их в инвентаре, где одна клетка - один предмет с количеством в углу.~~
7. ~~**Инвентарь (Данные):** Свяжи структуру данных (`inventory`) с UI. Отображай иконки (пока ColorRect) собранных предметов в слотах.~~
8. **Инвентарь (Drag&Drop):** Реализуй базовый перетаскивание между слотами *внутри* инвентаря. Обновляй структуру данных.
9. **Крафт:** Создай окно/панель рецептов. Реализуй ресурс `Recipe` и функцию проверки/выполнения крафта (по кнопке на рецепте). Добавь желтый предмет.
10. **Размещение:** Реализуй выбор предмета в инвентаре, превью, проверку коллизий, установку объекта на карту.
11. **Полировка:** Звуки, частицы при разрушении/установке, улучшение UI, ~~исправление багов.~~
